# $Id: PKGBUILD 40238 2009-05-29 01:53:53Z allan $
# Maintainer: Allan McRae <allan@archlinux.org>
# Committer: dorphell <dorphell@gmx.net>

pkgname=screen
pkgver=4.0.3
pkgrel=8
_ptygroup=5 #the UID of our PTY/TTY group
pkgdesc="Full-screen window manager that multiplexes a physical terminal"
arch=('i686' 'x86_64')
url="http://www.gnu.org/software/screen/"
license=('GPL')
depends=('ncurses' 'pam')
backup=('etc/screenrc' 'etc/pam.d/screen')
options=('!makeflags')
install=screen.install
source=(ftp://ftp.uni-erlangen.de/pub/utilities/screen/screen-${pkgver}.tar.gz \
        screen.pam \
        uao-patch/cjkwidth-mhsin.diff \
        uao-patch/uao.diff \
        uao-patch/table/conv.pl \
        uao-patch/table/uao_big5uni.map)
md5sums=('8506fd205028a96c741e4037de6e3c42' \
         '74f7919d7b65436cc2ea5341fa8ca374' \
         'd1b56ca6bf291f9ba2cb573b002a693a' \
         'd94b7ebba575eaebee159752f6219dfa' \
         'f4cb7efb54043e99c14f3bec868d1903' \
         'cf9a5736aa6dd298e1944a6350ade9cf')

build() {
  export LDFLAGS="${LDFLAGS} -Wl,--as-needed"

  cd ${srcdir}/${pkgname}-${pkgver}

  patch < ../../uao-patch/cjkwidth-mhsin.diff || return 1
  patch < ../../uao-patch/uao.diff || return 1
  perl  ../../uao-patch/table/conv.pl < ../../uao-patch/table/uao_big5uni.map > utf8encodings/18 || return 1

  ./configure --prefix=/usr --enable-pam \
        --with-sys-screenrc=/etc/screenrc --enable-colors256 \
       --enable-rxvt_osc --with-pty-group=$_ptygroup \
       --mandir=/usr/share/man --infodir=/usr/share/info
  make || return 1
  make DESTDIR=${pkgdir} install || return 1
  install -Dm644 ${srcdir}/screen.pam ${pkgdir}/etc/pam.d/screen

  install -Dm644 etc/completer.zsh ${pkgdir}/usr/share/zsh/site-functions/screen
  install -Dm644 etc/etcscreenrc ${pkgdir}/etc/screenrc
  install -Dm644 etc/screenrc ${pkgdir}/etc/skel/.screenrc

  rm ${pkgdir}/usr/share/info/dir
  gzip -9 ${pkgdir}/usr/share/info/*
}
